<!DOCTYPE html><html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>আবেদন অনুসন্ধান — জমি মিউটেশন</title>
  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="ময়মনসিংহ বিভাগের আবেদন অনুসন্ধান — আবেদন নাম্বার ও এনআইডি দিয়ে ফলাফল দেখুন" />
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b">
    <div class="max-w-xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-lg font-semibold">আবেদন অনুসন্ধান</h1>
      <span class="text-xs text-gray-500">মোবাইল ফ্রেন্ডলি</span>
    </div>
  </header>  <main class="max-w-xl mx-auto px-4 py-6">
    <div class="bg-white rounded-2xl shadow p-4 sm:p-6">
      <form id="searchForm" class="space-y-4" novalidate>
        <!-- Division (fixed to Mymensingh) -->
        <div>
          <label for="division" class="block text-sm font-medium mb-1">বিভাগ</label>
          <select id="division" name="division" class="w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 disabled:bg-gray-100" disabled>
            <option value="8" selected>ময়মনসিংহ</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">(এই ফর্মটি শুধুমাত্র ময়মনসিংহ বিভাগের জন্য সেট করা হয়েছে)</p>
        </div><!-- Application ID -->
    <div>
      <label for="app_id" class="block text-sm font-medium mb-1">আবেদন নাম্বার</label>
      <input id="app_id" name="app_id" inputmode="numeric" pattern="[0-9]*" placeholder="যেমন: 4595930" class="w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 px-3 py-2" required />
      <p id="appIdError" class="hidden mt-1 text-xs text-red-600">সঠিক আবেদন নাম্বার দিন।</p>
    </div>

    <!-- NID -->
    <div>
      <label for="nid_no" class="block text-sm font-medium mb-1">এনআইডি নাম্বার</label>
      <input id="nid_no" name="nid_no" inputmode="numeric" pattern="[0-9]*" placeholder="যেমন: 3746091234" class="w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 px-3 py-2" required />
      <p id="nidError" class="hidden mt-1 text-xs text-red-600">সঠিক এনআইডি নাম্বার দিন (শুধু সংখ্যা)।</p>
    </div>

    <!-- Submit -->
    <button id="submitBtn" type="submit" class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-indigo-600 text-white py-2.5 font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
      <svg id="spinner" class="hidden animate-spin h-4 w-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <span>সাবমিট</span>
    </button>
  </form>

  <!-- Notices -->
  <div class="mt-3 space-y-2">
    <div class="text-xs text-gray-500">দ্রষ্টব্য: সরকারি সার্ভারের নিরাপত্তা নীতির কারণে ব্রাউজার থেকে সরাসরি API কল করলে <em>CORS/CSRF</em> সমস্যা হতে পারে। প্রয়োজনে সার্ভার-সাইড প্রক্সি ব্যবহার করুন।</div>
  </div>
</div>

<!-- Result -->
<section id="resultWrap" class="mt-6 hidden">
  <div class="bg-white rounded-2xl shadow p-4 sm:p-6">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-base font-semibold">ফলাফল</h2>
      <button id="copyBtn" class="text-xs px-3 py-1.5 rounded-lg border hover:bg-gray-50">কপি</button>
    </div>
    <pre id="result" class="whitespace-pre-wrap text-sm bg-gray-50 rounded-xl p-3 overflow-x-auto"></pre>
  </div>
</section>

<!-- Error -->
<section id="errorWrap" class="mt-6 hidden">
  <div class="bg-red-50 border border-red-200 text-red-800 rounded-2xl p-4">
    <h3 class="font-semibold mb-1">রিকোয়েস্ট ব্যর্থ</h3>
    <p id="errorMsg" class="text-sm"></p>
  </div>
</section>

  </main>  <script>
    const form = document.getElementById('searchForm');
    const appIdInput = document.getElementById('app_id');
    const nidInput = document.getElementById('nid_no');
    const appIdError = document.getElementById('appIdError');
    const nidError = document.getElementById('nidError');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');

    const resultWrap = document.getElementById('resultWrap');
    const result = document.getElementById('result');
    const copyBtn = document.getElementById('copyBtn');

    const errorWrap = document.getElementById('errorWrap');
    const errorMsg = document.getElementById('errorMsg');

    function onlyDigits(v) { return String(v).replace(/\D+/g, ''); }

    // Input sanitization (digits only)
    appIdInput.addEventListener('input', () => {
      const clean = onlyDigits(appIdInput.value);
      if (appIdInput.value !== clean) appIdInput.value = clean;
      appIdError.classList.toggle('hidden', clean.length > 0);
    });
    nidInput.addEventListener('input', () => {
      const clean = onlyDigits(nidInput.value);
      if (nidInput.value !== clean) nidInput.value = clean;
      nidError.classList.toggle('hidden', clean.length > 0);
    });

    async function postSearch({ division_id = '8', app_id, nid_no }) {
      const url = 'https://mutation.land.gov.bd/api/search-main-application';
      const payload = {
        division_id: String(division_id),
        app_id: String(app_id),
        nid_no: String(nid_no),
        calculation: '1',
        addNumberResult: '1'
      };

      // Important: This endpoint may require cookies & XSRF token from the official site.
      // From a standalone site, the browser will likely block this (CORS),
      // so this call may fail unless you deploy a server-side proxy.
      const res = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json;charset=UTF-8',
          'Accept': 'application/json, text/plain, */*'
        },
        body: JSON.stringify(payload),
        credentials: 'include' // send cookies if user is already authenticated on the domain
      });

      if (!res.ok) {
        const text = await res.text();
        throw new Error(`HTTP ${res.status}: ${text?.slice(0, 500)}`);
      }
      return res.json();
    }

    function setLoading(loading) {
      submitBtn.disabled = loading;
      spinner.classList.toggle('hidden', !loading);
    }

    function showResult(data) {
      errorWrap.classList.add('hidden');
      resultWrap.classList.remove('hidden');
      result.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
    }

    function showError(message) {
      resultWrap.classList.add('hidden');
      errorWrap.classList.remove('hidden');
      errorMsg.textContent = message;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const app_id = onlyDigits(appIdInput.value);
      const nid_no = onlyDigits(nidInput.value);

      let valid = true;
      if (!app_id) { appIdError.classList.remove('hidden'); valid = false; }
      if (!nid_no) { nidError.classList.remove('hidden'); valid = false; }
      if (!valid) return;

      setLoading(true);
      try {
        const data = await postSearch({ app_id, nid_no });
        showResult(data);
      } catch (err) {
        // Friendly hint for CORS/CSRF
        const tip = '\n\nসম্ভবত CORS/CSRF বা অনুমতি সংক্রান্ত সমস্যা। এই ক্ষেত্রে একটি সার্ভার-সাইড প্রক্সি ব্যবহার করুন।';
        showError((err && err.message) ? (err.message + tip) : ('অজানা ত্রুটি ঘটেছে।' + tip));
      } finally {
        setLoading(false);
      }
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(result.textContent || '');
        copyBtn.textContent = 'কপি হয়েছে!';
        setTimeout(() => (copyBtn.textContent = 'কপি'), 1500);
      } catch {}
    });
  </script></body>
</html>
